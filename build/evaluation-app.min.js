var app=angular.module("EvaluationApp",["ui.bootstrap","ngRoute"]);app.config(function(a){a.when("/home/",{templateUrl:"templates/home.html",controller:"HomeController"}).when("/template/new",{templateUrl:"templates/newTemplate.html",controller:"TemplateController"}).when("/evaluation/new",{templateUrl:"templates/newEvaluation.html",controller:"EvaluationController"}).when("/evaluation/:evaluationID",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/evaluation/",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/",{templateUrl:"templates/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}),app.controller("EvaluationController",["$scope","ApiFactory","$routeParams","$location",function(a,b,c,d){var e=c.evaluationID;a.templates=[],a.init=function(c){void 0!==c?b.getEvaluationById(c).then(function(b){a.evaluation=b},function(b){console.log("Error fetching evaluation: "+b),a.errorMessage="Error fetching evaluation: "+b}):a.evaluation={TitleIS:"",TitleEN:"",IntroTextIS:"",IntroTextEN:"",CourseQuestions:[],TeacherQuestions:[]},"/evaluation/new"==d.url()&&(console.log("in new evaluation"),b.getAllTemplates().then(function(b){a.templates=b,a.template=b[0],a.startIsCollapsed=!0,a.endIsCollapsed=!0})),"/evaluation/"==d.url()&&console.log("in evaluation")},a.init(e),a.addAnswer=function(a){a.Answers.push("New answer")},a.addCourseQuestion=function(){a.evaluation.CourseQuestions.push({ID:a.evaluation.CourseQuestions.length,TextIS:"",TextEN:"",ImageURL:"",Type:"single",Answers:[]})},a.startTimeChanged=function(){}}]),app.controller("HomeController",["$scope","ApiFactory","$location",function(a,b,c){a.evaluations=[],a.showButton=function(){var a=b.getUser(),c=!1;return"admin"===a.Role&&(c=!0),c},a.editEvaluation=function(){},a.newEval=function(){c.path("/evaluation/new")},a.newTemplate=function(){c.path("/template/new")},a.getAllEvals=function(){a.status="Waiting...",b.getAllEvaluations().then(function(b){a.evaluations=b,a.status="Success."},function(b){a.status="Error: "+b})}}]),app.controller("LoginController",["$scope","ApiFactory","$location",function(a,b,c){a.loginCred={userName:"",password:""},a.token="",a.user="",a.login=function(d){b.login(d.user,d.pass).then(function(b){a.user=b.User,a.token=b.Token,c.path("/home/")},function(){a.errorMessage="Could not log in."})}}]),app.controller("TemplateController",["$scope","ApiFactory","$routeParams","$location",function(a,b){a.init=function(){a.templateInfo={},a.courseQuestions=[],a.teacherQuestions=[],a.infoSubmitted=!1,a.hideQuestionForm=!0,a.hideTeacherQuestionForm=!0,a.noTeacherQuestions=!0,a.noCourseQuestions=!0,a.hideError=!0},a.submitQuestion=function(b){a.courseQuestions.push({ID:a.courseQuestions.length,TextIS:b.TextIS,TextEN:b.TextEN,ImageURL:b.ImageURL,Type:b.Type}),a.hideQuestionForm=!0,b.ID="",b.TextIS="",b.TextEN="",b.ImageURL="",b.Type="",a.noCourseQuestions=!1},a.submitTeacherQuestion=function(b){a.teacherQuestions.push({ID:a.teacherQuestions.length,TextIS:b.TextIS,TextEN:b.TextEN,ImageURL:b.ImageURL,Type:b.Type}),a.hideTeacherQuestionForm=!0,b.ID="",b.TextIS="",b.TextEN="",b.ImageURL="",b.Type="",a.noTeacherQuestions=!1},a.displayQuestionForm=function(){a.hideQuestionForm=!1},a.displayTeacherQuestionForm=function(){a.hideTeacherQuestionForm=!1},a.submitTemplateInfo=function(b){a.templateInfo=b,a.infoSubmitted=!0},a.submitTemplate=function(){if(a.infoSubmitted&&a.courseQuestions.length+a.teacherQuestions.length>0){var c={ID:42,TitleIS:a.templateInfo.TitleIS,TitleEN:a.templateInfo.TitleEN,IntroTextIS:a.templateInfo.IntroTextIS,IntroTextEN:a.templateInfo.IntroTextEN,CourseQuestions:a.courseQuestions,TeacherQuestions:a.teacherQuestions};b.newTemplate(c)}else a.hideError=!1},a.init()}]),app.directive("myPane",function(){return{require:"^myTabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(a,b,c,d){d.addPane(a)},templateUrl:"my-pane.html"}}),app.directive("myAllEvaluations",function(){return{restrict:"E",transclude:!0,require:"^homeController",scope:!1,templateUrl:"my-tabs.html",link:function(){}}}),app.factory("ApiFactory",["$q","$timeout","$http",function(a,b,c){var d="http://dispatch.ru.is/H05/",e="",f="";return{getAllEvaluations:function(){var a=c.get(d+"api/v1/evaluations").then(function(a){return a.data});return a},getEvaluationById:function(a){var b=c.get(d+"api/v1/evaluations/"+a).then(function(a){return a.data});return b},addEvaluation:function(a){var b=c.post(d+"api/v1/evaluations",a).then(function(a){return console.log("Response: "+a),console.log("Response data: "+a.data),a.data});return console.log("Promise: "+b),b},login:function(a,b){var g=c.post(d+"api/v1/login",{user:a,pass:b}).then(function(a){return c.defaults.headers.common.Authorization="Basic "+a.data.Token,e=a.data.User,f=a.data.Token,a.data});return g},newEvaluation:function(a,b,e){var f=c.post(d+"api/v1/evaluations",{TemplateID:a,StartDate:b,EndDate:e}).then(function(a){return a.data});return f},newTemplate:function(a){var b=c.post(d+"api/v1/evaluationtemplates",a).then(function(a){return a.data});return b},getAllTemplates:function(){var a=c.get(d+"api/v1/evaluationtemplates").then(function(a){return a.data});return a},getTemplateById:function(a){var b=c.get(d+"api/v1/evaluationtemplates/"+a).then(function(a){return a.data});return b},getMyCourses:function(){var a=c.get(d+"api/v1/my/courses").then(function(a){return a.data});return a},getMyEvaluations:function(){var a=c.get(d+"api/v1/my/evaluations").then(function(a){return a.data});return a},getCourseTeacher:function(a,b){var e=c.get(d+"api/v1/courses/"+a+"/"+b+"/teachers").then(function(a){return a.data});return e},getCourseEvaluation:function(a,b,e){var f=c.get(d+"api/v1/courses/"+a+"/"+b+"/evaluations/"+e).then(function(a){return a.data});return f},saveAnswers:function(a,b,e,f){var g=c.post(d+"api/v1/courses/"+a+"/"+b+"/evaluations/"+e,f).then(function(a){return a.data});return g},getUser:function(){return e},getToken:function(){return f}}}]);