var app=angular.module("EvaluationApp",["ngRoute"]);app.config(function(a){a.when("/home/",{templateUrl:"templates/home.html",controller:"HomeController"}).when("/evaluation/:evaluationID",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/evaluation/",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/",{templateUrl:"templates/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}),app.controller("EvaluationController",["$scope","ApiFactory","$routeParams",function(a,b,c){var d=c.evaluationID;void 0!==d?b.getEvaluationById(d).then(function(b){a.evaluation=b},function(a){console.log("Error fetching evaluation: "+a)}):a.evaluation={TitleIS:"",TitleEN:"",IntroTextIS:"",IntroTextEN:"",CourseQuestions:[],TeacherQuestions:[]},a.addAnswer=function(a){a.Answers.push("New answer")},a.addCourseQuestion=function(){a.evaluation.CourseQuestions.push({ID:a.evaluation.CourseQuestions.length,TextIS:"",TextEN:"",ImageURL:"",Type:"single",Answers:[]})}}]),app.controller("HomeController",["$scope","ApiFactory",function(a,b){a.showButton=function(){return"admin"==b.getUser().Role?!0:!1},b.getAllEvaluations().then(function(b){console.log("Success, data: ",b),a.evaluations=b},function(a){console.log("Error: "+a)},function(a){console.log("Update: "+a)})}]),app.controller("LoginController",["$scope","ApiFactory","$location",function(a,b,c){a.loginCred={userName:"",password:""},a.token="",a.user="",a.login=function(d){console.log("Logged in"),b.login(d.user,d.pass).then(function(d){a.user=d.User,a.token=d.Token,console.log("THE TOKEN: "+b.getToken()),console.log("Logged in as "+b.getUser().Role),c.path("/home/")},function(){console.log("Could not log in.")})}}]),app.factory("ApiFactory",["$q","$timeout","$http",function(a,b,c){var d="http://project3api.haukurhaf.net/",e="",f="";return{getAllEvaluations:function(){{var b=a.defer();c.get(d+"api/v1/evaluations").success(function(a){b.resolve(a)}).error(function(){b.reject("Failed to get evaluations.")})}return b.promise},getEvaluationById:function(b){var c=a.defer();return evaluations[b]?c.resolve(evaluations[b]):c.reject("No evaluation with this id"),c.promise},addEvaluation:function(){var b=a.defer();return b.promise},login:function(b,g){{var h=a.defer();c.post(d+"api/v1/login",{user:b,pass:g}).success(function(a){c.defaults.headers.common.Authorization="Basic "+a.Token,e=a.User,f=a.Token,h.resolve(a)}).error(function(){h.reject("Failed to log in.")})}return h.promise},newEvaluation:function(b,e,f){{var g=a.defer();c.post(d+"api/v1/evaluations",{TemplateID:b,StartDate:e,EndDate:f}).success(function(a){g.resolve(a)}).error(function(){g.reject("Failed to submit evaluation")})}return g.promise},newTemplate:function(b,e,f,g,h,i){{var j=a.defer();c.post(d+"api/v1/evaluationtemplates",{ID:b,TitleIS:e,TitleEN:f,IntroTextIS:g,IntroTextEN:h,CourseQuestions:i}).success(function(a){j.resolve(a)}).error(function(){j.reject("Failed to submit new template")})}return j.promise},getUser:function(){return e},getToken:function(){return f}}}]);