var app=angular.module("EvaluationApp",["angles","ui.bootstrap","ngRoute"]);app.config(function(a){a.when("/home/",{templateUrl:"templates/home.html",controller:"HomeController"}).when("/template/new",{templateUrl:"templates/newTemplate.html",controller:"TemplateController"}).when("/evaluation/new",{templateUrl:"templates/newEvaluation.html",controller:"EvaluationController"}).when("/evaluation/:evaluationID",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/evaluation/",{templateUrl:"templates/evaluation.html",controller:"EvaluationController"}).when("/results",{templateUrl:"templates/results.html",controller:"ResultsController"}).when("/",{templateUrl:"templates/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}),app.controller("EvaluationController",["$scope","ApiFactory","$routeParams","$location",function(a,b,c,d){var e=c.evaluationID;a.evaluationTemplate={ID:"",TitleIS:"",TitleEN:"",IntroTextIS:"",IntroTextEN:"",CourseQuestions:[],TeacherQuestions:[]},a.answers=[],a.hideError=!0,a.init=function(c){void 0!==c?b.getEvaluationById(c).then(function(b){a.evaluation=b,a.getTemplate(a.evaluation)},function(b){console.log("Error fetching evaluation: "+b),a.errorMessage="Error fetching evaluation: "+b}):a.evaluation={TitleIS:"",TitleEN:"",IntroTextIS:"",IntroTextEN:"",CourseQuestions:[],TeacherQuestions:[]},"/evaluation/new"==d.url()&&(console.log("in new evaluation"),b.getAllTemplates().then(function(b){a.templates=b,a.template=b[0],a.startIsCollapsed=!0,a.endIsCollapsed=!0})),"/evaluation/"==d.url()&&console.log("in evaluation")},a.init(e),a.getTemplate=function(c){b.getTemplateById(c.TemplateID).then(function(b){a.evaluationTemplate=b,a.evaluationTemplate.CourseAnswers=[];for(var c=0;c<a.evaluationTemplate.CourseQuestions.length;c++)a.evaluationTemplate.CourseAnswers.push({Question:a.evaluationTemplate.CourseQuestions[c].TextIS,ID:a.evaluationTemplate.CourseQuestions[c].ID,Answer:""});for(a.evaluationTemplate.TeacherAnswers=[],c=0;c<a.evaluationTemplate.TeacherQuestions.length;c++)a.evaluationTemplate.TeacherAnswers.push({Question:a.evaluationTemplate.TeacherQuestions[c].TextIS,ID:a.evaluationTemplate.TeacherQuestions[c].ID,Answer:""})},function(a){console.log("failed to fetch template for evaluation "+a)})},a.templates=[],a.template=a.templates[0],a.addAnswer=function(a){a.Answers.push("New answer")},a.addCourseQuestion=function(){a.evaluation.CourseQuestions.push({ID:a.evaluation.CourseQuestions.length,TextIS:"",TextEN:"",ImageURL:"",Type:"single",Answers:[]})},a.startTimeChanged=function(b){a.startTime=b},a.endTimeChanged=function(b){a.endTime=b},a.hstep=1,a.mstep=15,a.startTime="",a.endTime="",a.submitEvaluation=function(){""===a.startTime&&(a.startTime=new Date),""===a.endTime&&(a.endTime=new Date),b.newEvaluation(a.template.ID,a.startTime,a.endTime)},a.submitAnswers=function(){for(var c=0;c<a.evaluationTemplate.TeacherAnswers.length;c++)if(""===a.evaluationTemplate.TeacherAnswers[c].Answer)return void(a.hideError=!1);for(c=0;c<a.evaluationTemplate.CourseAnswers.length;c++)if(""===a.evaluationTemplate.CourseAnswers[c].Answer)return void(a.hideError=!1);for(retObjs=[],c=0;c<a.evaluationTemplate.TeacherAnswers.length;c++)retObjs.push({QuestionID:a.evaluationTemplate.TeacherAnswers.ID,TeacherSSN:null,Value:a.evaluationTemplate.TeacherAnswers.Answer});for(c=0;c<a.evaluationTemplate.CourseAnswers.length;c++)retObjs.push({QuestionID:a.evaluationTemplate.CourseAnswers.ID,TeacherSSN:null,Value:a.evaluationTemplate.CourseAnswers.Answer});b.saveAnswers("T-427-WEPO",null,a.evaluation.ID,retObjs).then(function(){console.log("success sending answers!")},function(a){console.log("failed to send answers: "+a)})}}]),app.controller("HomeController",["$scope","ApiFactory","$location",function(a,b,c){a.evaluations=[],a.courses=[],a.showButton=function(){var a=b.getUser(),c=!1;return"admin"===a.Role&&(c=!0),c},a.editEvaluation=function(){c.path("/evaluation/edit")},a.results=function(){c.path("/results")},a.newEval=function(){c.path("/evaluation/new")},a.newTemplate=function(){c.path("/template/new")},a.getAllEvals=function(){b.getAllEvaluations().then(function(b){a.evaluations=b,console.log(b)})},a.getMyCourses=function(){b.getMyCourses().then(function(b){a.courses=b,console.log(b)})},this.init=function(){a.getAllEvals(),a.getMyCourses()},this.init()}]),app.controller("LoginController",["$scope","ApiFactory","$location",function(a,b,c){a.loginCred={userName:"",password:""},a.token="",a.user="",a.login=function(d){b.login(d.user,d.pass).then(function(b){a.user=b.User,a.token=b.Token,c.path("/home/")},function(){a.errorMessage="Could not log in."})}}]),app.controller("ResultsController",["$scope","ApiFactory","$location",function(a){a.chart={labels:["Monday","Tuesday","Wednesday","Thursday","Friday"],datasets:[{fillColor:"rgba(151,187,205,0)",strokeColor:"#e67e22",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:[4,3,5,4,6]},{fillColor:"rgba(151,187,205,0)",strokeColor:"#f1c40f",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#f1c40f",data:[8,3,2,5,4]}]},a.data={ID:1,TemplateID:2,TemplateTitleIS:"sample string 3",TemplateTitleEN:"sample string 4",Courses:[{ID:1,CourseID:"sample string 2",Semester:"sample string 3",CourseNameIS:"sample string 4",CourseNameEN:"sample string 5",Questions:[{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]}]},{ID:1,CourseID:"sample string 2",Semester:"sample string 3",CourseNameIS:"sample string 4",CourseNameEN:"sample string 5",Questions:[{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]}]},{ID:1,CourseID:"sample string 2",Semester:"sample string 3",CourseNameIS:"sample string 4",CourseNameEN:"sample string 5",Questions:[{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]},{QuestionID:1,TextIS:"sample string 2",TextEN:"sample string 3",TeacherSSN:"sample string 4",Type:"sample string 5",TextResults:["sample string 1","sample string 2","sample string 3"],OptionsResults:[{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5},{Answer:1,AnswerTextIS:"sample string 2",AnswerTextEN:"sample string 3",Weight:4,Count:5}]}]}]}}]),app.controller("TemplateController",["$scope","ApiFactory","$routeParams","$location",function(a,b){a.init=function(){a.templateInfo={},a.courseQuestions=[],a.courseOptionQuestions=[],a.teacherQuestions=[],a.teacherOptionQuestions=[],a.infoSubmitted=!1,a.hideQuestionForm=!0,a.hideQuestionForm=!0,a.noTeacherQuestions=!0,a.noCourseQuestions=!0,a.hideError=!0,a.typePromptToggle=!0,a.hideOptionButton=!0,a.questionOptions=[],a.hideOptionEntry=!0,a.hideMultipleQuestionForm=!0,a.hideAddQuestionButton=!1,a.hideSubmitButton=!0,a.teacherOrCourse=["Teacher","Course"],a.typeSelection=a.teacherOrCourse[0]},a.submitQuestion=function(b){var c={TextIS:b.TextIS,TextEN:b.TextEN,ImageURL:b.ImageURL,Type:"text"};"Teacher"===a.typeSelection&&(c.ID=a.teacherQuestions.length,a.teacherQuestions.push(c),a.noTeacherQuestions=!1),"Course"===a.typeSelection&&(c.ID=a.courseQuestions.length,a.courseQuestions.push(c),a.noCourseQuestions=!1),a.hideQuestionForm=!0,b.ID="",b.TextIS="",b.TextEN="",b.ImageURL="",b.Type=""},a.displayQuestionForm=function(){a.hideQuestionForm=!1},a.submitTemplateInfo=function(b){a.templateInfo=b,a.infoSubmitted=!0},a.submitTemplate=function(){if(a.infoSubmitted&&a.courseQuestions.length+a.teacherQuestions.length>0){var c={ID:42,TitleIS:a.templateInfo.TitleIS,TitleEN:a.templateInfo.TitleEN,IntroTextIS:a.templateInfo.IntroTextIS,IntroTextEN:a.templateInfo.IntroTextEN,CourseQuestions:a.courseQuestions,TeacherQuestions:a.teacherQuestions};b.newTemplate(c)}else a.hideError=!1},a.typePrompt=function(){a.typePromptToggle=!a.typePromptToggle,a.hideAddQuestionButton=!a.hideAddQuestionButton},a.addTextQuestion=function(){a.typePromptToggle=!a.typePromptToggle,a.hideQuestionForm=!a.hideQuestionForm},a.addMultipleChoiceQuestion=function(){a.typePromptToggle=!a.typePromptToggle,a.hideMultipleQuestionForm=!a.hideMultipleQuestionForm},a.addOption=function(){a.hideOptionButton||(a.hideOptionButton=!0),a.hideOptionEntry=!a.hideOptionEntry},a.optionSubmit=function(){a.hideOptionEntry=!a.hideOptionEntry,a.questionOptions.push({No:a.questionOptions.length+1,TextIS:a.optionEntryIS,TextEN:a.optionEntryEN,Weight:a.optionEntryWeight,ImageURL:a.optionEntryImageURL}),a.optionEntryIS="",a.optionEntryEN="",a.optionEntryWeight="",a.optionEntryImageURL="",a.hideSubmitButton=!1},a.submitOptionQuestion=function(b){for(var c=[],d=0;d<a.questionOptions.length;d++)c.push({ID:d,TextIS:a.questionOptions[d].TextIS,TextEN:a.questionOptions[d].TextEN,Weight:a.questionOptions[d].Weight,ImageURL:a.questionOptions[d].ImageURL});a.questionOptions=[];var e={TextIS:b.TextIS,TextEN:b.TextEN,ImageURL:b.ImageURL,Answers:c,Type:"multi"};"Teacher"===a.typeSelection&&(e.ID=a.teacherOptionQuestions.length,a.teacherOptionQuestions.push(e),console.log("Teacher option questions: "+a.teacherOptionQuestions.length),a.noTeacherQuestions=!1),"Course"===a.typeSelection&&(e.ID=a.courseOptionQuestions.length,a.courseOptionQuestions.push(e),console.log("Course option questions: "+a.courseOptionQuestions.length),a.noCourseQuestions=!1),a.hideMultipleQuestionForm=!0,a.typePromptToggle=!0,b.ID="",b.TextIS="",b.TextEN="",b.ImageURL="",b.Type=""},a.init()}]),app.directive("myEvals",function(){return{restrict:"E",controller:"HomeController",templateUrl:"templates/partials/myEvalsPartial.html"}}),app.directive("myChart",function(){return{restrict:"E",controller:"ResultsController",templateUrl:"templates/partials/myChartPartial.html"}}),app.factory("ApiFactory",["$q","$timeout","$http",function(a,b,c){var d="http://dispatch.ru.is/H05/",e="",f="";return{getAllEvaluations:function(){var a=c.get(d+"api/v1/evaluations").then(function(a){return a.data});return a},getEvaluationById:function(a){var b=c.get(d+"api/v1/evaluations/"+a).then(function(a){return a.data});return b},addEvaluation:function(a){var b=c.post(d+"api/v1/evaluations",a).then(function(a){return console.log("Response: "+a),console.log("Response data: "+a.data),a.data});return console.log("Promise: "+b),b},login:function(a,b){var g=c.post(d+"api/v1/login",{user:a,pass:b}).then(function(a){return c.defaults.headers.common.Authorization="Basic "+a.data.Token,e=a.data.User,f=a.data.Token,a.data});return g},newEvaluation:function(a,b,e){var f=c.post(d+"api/v1/evaluations",{TemplateID:a,StartDate:b,EndDate:e}).then(function(a){return a.data});return f},newTemplate:function(a){var b=c.post(d+"api/v1/evaluationtemplates",a).then(function(a){return a.data});return b},getAllTemplates:function(){var a=c.get(d+"api/v1/evaluationtemplates").then(function(a){return a.data});return a},getTemplateById:function(a){var b=c.get(d+"api/v1/evaluationtemplates/"+a).then(function(a){return a.data});return b},getMyCourses:function(){var a=c.get(d+"api/v1/my/courses").then(function(a){return a.data});return a},getMyEvaluations:function(){var a=c.get(d+"api/v1/my/evaluations").then(function(a){return a.data});return a},getCourseTeacher:function(a,b){var e=c.get(d+"api/v1/courses/"+a+"/"+b+"/teachers").then(function(a){return a.data});return e},getCourseEvaluation:function(a,b,e){var f=c.get(d+"api/v1/courses/"+a+"/"+b+"/evaluations/"+e).then(function(a){return a.data});return f},saveAnswers:function(a,b,e,f){var g=c.post(d+"api/v1/courses/"+a+"/"+b+"/evaluations/"+e,f).then(function(a){return a.data});return g},getUser:function(){return e},getToken:function(){return f}}}]);